# MobileIDforSoldier (모바일 군 출입증)   [by 상병 이종석]
--- 2017군 장병 공개SW 역량강화 소집교육간 제출용 개인 프로젝트 --- 
<br>
## App 개요
 군 간부 및 군무원 분들이 사용하는 출입증을 스마트폰에 등록하여 사용할 수 있게 한 App입니다.

 출입증을 NFC태그 또는 출입증 정보 입력으로 기기에 등록하면 기기를 출입증처럼 사용할 수 있게 됩니다.
<br><br>
## 현 실태
 출입증 리더기가 설치된 위병소를 드나들 때는 출입증을 찍어야 해서 출입증을 항상 들고 다녀야 해서 불편하다는 분들이 있습니다.
 또한, 출입증의 분실이나 파손 또한 종종 발생하곤 합니다.
<br><br>
## App의 야전 배포 시(실제로 군 체계에 적용 시) 기대효과
 스마트폰에 이 출입증 앱을 설치하고 앱에 출입증을 등록하면 스마트폰이 곧 출입증이 되기 때문에
  더 이상 출입증을 따로 들고 다니지 않아도 되어 편리하며, 출입증을 잃어버리거나 파손될 염려도 없습니다. 

 또한, 일반 출입증이 완전히 스마트폰용 출입증으로 대체되면 기존에 일반 출입증 제작에 필요했던 국방비를 아낄 수 있게 될 것으로 전망합니다.
<br><br>
## 사용법
 - App :
  먼저 메인 액티비티(앱 실행 시첫 화면)의 가운데 카드 버튼을 눌러 NFC로 추가 또는 출입증 정보 직접 입력으로 들어가서 출입증을 기기에 등록합니다.
  NFC로 추가의 경우 기기의 NFC 읽기/쓰기 기능을 켠 후, 현재 사용하시는 출입증을 태그하시면 되며,
  정보 직접 입력의 경우 군번, 계급 ,이름, (현재 사용하시는 출입증의)발급일자를 입력하시고 [저장] 버튼을 누르시면 등록됩니다.
 
 	 이후에는 메인 액티비티(첫 화면)를 띄운 상태에서 일반 출입증을 위병소 리더기에 찍듯이 스마트폰을 리더기에 찍으시면 됩니다.
 
  	일반 출입증처럼 자신의 증명사진도 등록하고 싶으시다면, 출입증 등록 후에 
  	메인 액티비티의 오른쪽 하단에 보이는 작고 둥근 [사진 추가] 버튼을 누르셔서
  	사진을 메인 액티비티 중앙에 등록하실 수 있습니다.
 
  	서버와 App간 자체 통신은 메인 액티비티의 맨 아래에 있는 [등록 테스트] 버튼을 누르셨을 때 나오는 화면에서 시도하시면 됩니다. 
  	자세한 방법은 아래의 "서버와의 App내 자체 통신법" 항목에 설명되어 있습니다.<br><br>


 - Server :
  server폴더에 있는 app.js를 콘솔에서 node app.js 명령으로 실행시킵니다.

  	데이터베이스는 첨부된 SQL파일로 데이터베이스 생성 후, 데이버베이스 서버를 실행시킵니다.

  	첨부된 SQL파일을 통해 생성되는 데이터베이스

  	(Database 이름 : OSAM,  Table 이름 : LeeJongSeok)
 			column값은 [servicenumber, rank, name, date]<br>
 	 에 기본으로 들어있는 더미 데이터인

 	 |servicenumber| rank    | name | date |
	 |-------------|---------|------|------|
	 |		1111   | private | test | 2017 |
 	 |		1234   | general | kim  | 2000 |
	 |		0000   | king    | abc  | 2010 |

 	을 사용해서 아래 "서버와의 App내 자체 통신법"을 참조해서 app과 서버간 통신을 시도하시거나,

 	웹브라우저에서 http://{서버IP주소}:5037/public/addidcard.html  
 	또는 http://{서버IP주소}:5037/ (여기로 접속시, 앞의 페이지로 자동으로 리다이렉트됨.)
 	에 접속하셔서 추가하고 싶은 데이터를 추가하신 후, 
 	그 데이터와 동일한 데이터를 app에 추가하고 아래에 나와 있는 방법으로 서버와 통신하시면 됩니다.

<br><br>
### 서버와의 App내 자체 통신법 (중요!)
 이 앱은 기기를 리더기에 태그했을 때 리더기가 기기의 데이터를 읽어들여 서버의 데이터베이스에서 조회해서 그 결과를 받아오는 구성을 전제로 만들었습니다.

 하지만, 앱 자체가 서버와 직접 통신하는 것을 확인해야 했기 때문에 앱 자체적으로 기기에 저장된 출입증 정보를 서버로 보내서 서버의 데이터베이스에서
 조회한 결과를 받을 수 있는 기능을 넣었습니다. 서버에 기기에서 보낸 것과 동일한 출입증 데이터가 존재하면, '출입증 정품 확인 성공' 이라는 메시지를 받을 수 있습니다.

  출입증을 기기에 등록한 후, 메인 액티비티 하단의 [등록 테스트] 버튼을 눌러서 등록 테스트 액티비티로 들어가서 서버의 IPv4주소를 치고 [서버 송신] 버튼을 누르면
  서버의 데이터베이스에서 기기의 출입증 데이터를 조회해서 결과를 받아옵니다.

  통신 확인 전에 반드시 첨부된 SQL 데이터베이스를 설치하신 후, 첨부된 node.js 서버를 실행 (app.js 파일이 서버의 메인 실행파일입니다) 하셔야 앱과 서버간의 통신이 가능합니다.
  또한, 앱과 서버에 완전히 동일한 출입증 데이터를 저장해야 정식 출입증으로 인식합니다.
<br><br>
### 기타
   - 이 앱에 저장하게 되는 출입증 데이터는 실제로 사용하는 군 출입증에 저장된 정보가 정확히 무엇인지 알 수 없었기에 임의로 지정한 데이터 값입니다. 

   - apk파일은 debug와 release 둘 모두로 생성했으며, 각각 app-debug.apk 와 app-release.apk입니다. 위에 보면 파일 있습니다.

   - SQL 데이터베이스 생성 파일은 server폴더에 들어있습니다.

<br><br>
## App & Server 구조
 @ Android App (Android 프로젝트 구조로 구분함):

  	app/
 		mainfests

 		java class file/
 			MainActivity			: 첫 화면. 출입증이 기기에 등록되었다면, 
 									  이 화면을 띄운 상태로 리더기에 찍으면 된다.
 				-UserEditActivity	: 출입증을 NFC로 추가할 것인지, 
 									  정보를 직접 입력해서 추가할 것인지 선택해서 해당 액티비티로 분기
 					-AddwithNFC		: NFC로 출입증 추가
 					-AddwithSelf	: 출입증 정보를 직접 입력해서 추가
 				-LinkTestActivity	: 기기에 등록된 출입증이 서버에 등록된 정식 출입증이 맞는지를 
 									  수동으로 확인하는 액티비티.

 			Dao	: 데이터베이스 헬퍼 클래스를 상속한 커스텀 클래스

 		res/
 			layout/
 				activity_main.xml
 				activity_user_edit.xml
 				activity_addwith_nfc.xml
 				activity_addwith_self.xml
 				activity_link_test.xml


 @ Node.js Server (디렉토리로 구분함) :

 	app.js : 서버 실행 파일. 서버는 5037 포트를 사용. Database 포트는 3306을 사용.
 	package.json

 	/public : 
 		addidcard.html : 테스트할 출입증 정보를 웹 상에서 저장할 수 있도록 하기 위해 만든 간단한 웹페이지. 
 						 웹브라우저로 서버에 접속 시 자동으로 이 페이지로 리다이렉트된다.

 	/routes:
 		addIdCard.js : addidcard.html 에서 호출되는 라우팅 함수. app.js에서 모듈을 불러와 사용.
 		checkIdCard.js : android app 에서 출입증 정품 확인을 요청 시 호출되는 라우팅 함수. app.js에서 모듈을 불러와 사용.
 						 출입증 조회 결과를 app으로 다시 반환해준다.

 	OSAM.sql : 데이터베이스 생성용 SQL (*중요!!!*)
 		Database 이름 : OSAM,  Table 이름 : LeeJongSeok 인 데이터베이스를 생성해주는 sql문서이다.
 		column값은 [servicenumber, rank, name, date] 이며,
 		테스트용 데이터 row로는 
			
 			(1111, private, test, 2017),
 			(1234, general, kim, 2000),
 			(0000, king, abc, 2010)
			
 			이 들어있다.

<br><br>
## 추후 개선해야 할 점
- 보안
	- 데이터베이스에 출입증 정보를 저장할 때 암호화해서 저장할 필요가 있다.(App/Server 공통)
<br>

- 버그
	- 화면이 작은 기기에서는 종종 화면 레이아웃 요소가 어긋나게 표시되거나, 화면 밖으로 잘려서 표시되지 않는 경우가 있다. (App)